--!strict
--[[
	A LocalScript to create a single, modern, enhanced, and dynamic UI menu.
	This script is designed to be placed in StarterPlayerScripts.
	
	This version includes the full UI, with a two-panel tabbed layout, a corrected
	minimization feature, and a new "Teleport" tab with speed-controlled tweening.
]]

-- SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

-- CONFIGURATION
local UI_SIZE = UDim2.new(0, 600, 0, 500) -- Increased UI size for better aesthetics
local MINIMIZED_HEIGHT = 45 -- Height of the title bar
local TAB_WIDTH = 150
local TITLE_FONT = Enum.Font.SourceSansBold
local BODY_FONT = Enum.Font.SourceSans
local FONT_COLOR = Color3.fromRGB(220, 220, 220)
local FROSTED_BACKGROUND = Color3.fromRGB(25, 25, 25)
local BORDER_COLOR = Color3.fromRGB(60, 60, 60)
local SHADOW_COLOR = Color3.fromRGB(0, 0, 0)
local ACCENT_COLOR = Color3.fromRGB(170, 85, 255) -- Vibrant purple accent

-- Tab-specific colors for visual separation
local BOSS_ACCENT = Color3.fromRGB(255, 85, 85) -- Red
local ESP_ACCENT = Color3.fromRGB(85, 255, 85) -- Green
local FARM_ACCENT = Color3.fromRGB(85, 255, 255) -- Cyan
local FRUIT_ACCENT = Color3.fromRGB(255, 170, 0) -- Orange
local TELEPORT_ACCENT = Color3.fromRGB(85, 170, 255) -- Blue for Teleport

local NPC_ESP_DISTANCE = 500
local TRACER_COLOR = Color3.fromRGB(255, 170, 0)
local TRACER_THICKNESS = 0.2
local TRACER_TRANSPARENCY = 0.2
local TWEEN_SPEED = 100
local ESP_VERTICAL_OFFSET = 20 -- Adjusted vertical offset for ESP labels for better visibility

-- Get the player's PlayerGui to store the UI
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- Create a container for the tracers
local TracerContainer = Instance.new("Folder")
TracerContainer.Name = "TracerContainer"
TracerContainer.Parent = Workspace

-- Main ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "UnifiedMenu"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

-- =================================================================
-- === UI Utility Functions ========================================
-- =================================================================

-- Creates a main container frame with a modern, frosted glass look
local function createMainFrame(size: UDim2, position: UDim2, parent: Instance)
	local frame = Instance.new("Frame")
	frame.Name = "MainFrame"
	frame.Size = size
	frame.Position = position
	frame.AnchorPoint = Vector2.new(0.5, 0.5)
	frame.BackgroundColor3 = FROSTED_BACKGROUND
	frame.BackgroundTransparency = 0.2
	frame.BorderSizePixel = 0
	frame.Parent = parent

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 15)
	corner.Parent = frame

	local stroke = Instance.new("UIStroke")
	stroke.Color = BORDER_COLOR
	stroke.Thickness = 1.5
	stroke.Transparency = 0.5
	stroke.Parent = frame

	local shadow = Instance.new("UIStroke")
	shadow.Name = "ShadowStroke"
	shadow.Color = SHADOW_COLOR
	shadow.Thickness = 3
	shadow.Transparency = 0.6
	shadow.Parent = frame

	return frame
end

-- Creates the draggable title bar with an accent gradient
local function createTitleBar(parent: Instance, title: string)
	local titleBar = Instance.new("Frame")
	titleBar.Name = "TitleBar"
	titleBar.Size = UDim2.new(1, 0, 0, MINIMIZED_HEIGHT)
	titleBar.BackgroundTransparency = 1
	titleBar.BorderSizePixel = 0
	titleBar.Parent = parent

	local gradient = Instance.new("UIGradient")
	gradient.Color = ColorSequence.new(ACCENT_COLOR, ACCENT_COLOR:Lerp(Color3.new(0,0,0), 0.5))
	gradient.Rotation = 90
	gradient.Parent = titleBar

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Name = "TitleLabel"
	titleLabel.Size = UDim2.new(1, -120, 1, 0)
	titleLabel.Position = UDim2.new(0, 15, 0, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.TextColor3 = FONT_COLOR
	titleLabel.TextScaled = true
	titleLabel.Font = TITLE_FONT
	titleLabel.Text = title
	titleLabel.TextXAlignment = Enum.TextXAlignment.Left
	titleLabel.TextYAlignment = Enum.TextYAlignment.Center
	titleLabel.Parent = titleBar

	-- Minimize button
	local minimizeButton = Instance.new("TextButton")
	minimizeButton.Name = "MinimizeButton"
	minimizeButton.Size = UDim2.new(0, 30, 0, 30)
	minimizeButton.Position = UDim2.new(1, -75, 0.5, -15)
	minimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	minimizeButton.BorderSizePixel = 0
	minimizeButton.Text = "-"
	minimizeButton.TextColor3 = FONT_COLOR
	minimizeButton.TextSize = 25
	minimizeButton.Font = TITLE_FONT
	minimizeButton.Parent = titleBar
	
	local minCorner = Instance.new("UICorner")
	minCorner.CornerRadius = UDim.new(0, 8)
	minCorner.Parent = minimizeButton

	-- Nuke button
	local nukeButton = Instance.new("TextButton")
	nukeButton.Name = "NukeButton"
	nukeButton.Size = UDim2.new(0, 30, 0, 30)
	nukeButton.Position = UDim2.new(1, -40, 0.5, -15)
	nukeButton.BackgroundColor3 = BOSS_ACCENT:Lerp(Color3.new(0,0,0), 0.5)
	nukeButton.BorderSizePixel = 0
	nukeButton.Text = "X"
	nukeButton.TextColor3 = FONT_COLOR
	nukeButton.TextSize = 20
	nukeButton.Font = TITLE_FONT
	nukeButton.Parent = titleBar
	
	local nukeCorner = Instance.new("UICorner")
	nukeCorner.CornerRadius = UDim.new(0, 8)
	nukeCorner.Parent = nukeButton
	
	-- Hover effects for buttons
	minimizeButton.MouseEnter:Connect(function() TweenService:Create(minimizeButton, TweenInfo.new(0.2), {BackgroundColor3 = ACCENT_COLOR}):Play() end)
	minimizeButton.MouseLeave:Connect(function() TweenService:Create(minimizeButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 50)}):Play() end)
	nukeButton.MouseEnter:Connect(function() TweenService:Create(nukeButton, TweenInfo.new(0.2), {BackgroundColor3 = BOSS_ACCENT}):Play() end)
	nukeButton.MouseLeave:Connect(function() TweenService:Create(nukeButton, TweenInfo.new(0.2), {BackgroundColor3 = BOSS_ACCENT:Lerp(Color3.new(0,0,0), 0.5)}):Play() end)

	return titleBar, minimizeButton, nukeButton
end

-- Creates a sleek tab button
local function createTabButton(parent: Instance, name: string, accentColor: Color3, layoutOrder: number)
	local button = Instance.new("TextButton")
	button.Name = name .. "Tab"
	button.LayoutOrder = layoutOrder
	button.Size = UDim2.new(1, -10, 0, 50)
	button.BackgroundColor3 = FROSTED_BACKGROUND:Lerp(Color3.new(1,1,1), 0.1)
	button.BackgroundTransparency = 0.5
	button.BorderSizePixel = 0
	button.TextColor3 = FONT_COLOR
	button.Text = name
	button.TextScaled = true
	button.Font = TITLE_FONT
	button.Parent = parent

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 8)
	corner.Parent = button

	-- Hover effects
	button.MouseEnter:Connect(function() TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = FROSTED_BACKGROUND:Lerp(Color3.new(1,1,1), 0.25)}):Play() end)
	button.MouseLeave:Connect(function() TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = FROSTED_BACKGROUND:Lerp(Color3.new(1,1,1), 0.1)}):Play() end)
	
	return button
end

-- Creates a toggle button with a clean checkbox style
local function createToggleButton(parent: Instance, text: string, accentColor: Color3, initialActiveState: boolean, layoutOrder: number)
	local container = Instance.new("Frame")
	container.Name = "ToggleContainer"
	container.LayoutOrder = layoutOrder
	container.Size = UDim2.new(1, -20, 0, 45)
	container.BackgroundColor3 = FROSTED_BACKGROUND
	container.BackgroundTransparency = 0.4
	container.BorderSizePixel = 0
	container.Parent = parent

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 8)
	corner.Parent = container

	local button = Instance.new("TextButton")
	button.Name = "ToggleButton"
	button.Size = UDim2.new(1, 0, 1, 0)
	button.BackgroundTransparency = 1
	button.Text = ""
	button.Parent = container

	local toggleBox = Instance.new("Frame")
	toggleBox.Name = "ToggleBox"
	toggleBox.Size = UDim2.new(0, 20, 0, 20)
	toggleBox.Position = UDim2.new(0, 10, 0.5, -10)
	toggleBox.BackgroundColor3 = if initialActiveState then accentColor else Color3.fromRGB(80, 80, 80)
	toggleBox.BorderSizePixel = 1
	toggleBox.BorderColor3 = BORDER_COLOR
	toggleBox.Parent = button

	local boxCorner = Instance.new("UICorner")
	boxCorner.CornerRadius = UDim.new(0, 5)
	boxCorner.Parent = toggleBox

	local checkmark = Instance.new("ImageLabel")
	checkmark.Name = "Checkmark"
	checkmark.BackgroundTransparency = 1
	checkmark.Size = UDim2.new(1, 0, 1, 0)
	checkmark.Image = "rbxassetid://603417770" -- Checkmark image
	checkmark.ImageColor3 = FONT_COLOR
	checkmark.Visible = initialActiveState
	checkmark.Parent = toggleBox

	local label = Instance.new("TextLabel")
	label.Name = "Label"
	label.Size = UDim2.new(1, -40, 1, 0)
	label.Position = UDim2.new(0, 35, 0, 0)
	label.BackgroundTransparency = 1
	label.TextColor3 = FONT_COLOR
	label.Text = text
	label.TextScaled = true
	label.Font = BODY_FONT
	label.TextXAlignment = Enum.TextXAlignment.Left
	label.Parent = button
	
	-- Hover effect
	container.MouseEnter:Connect(function() TweenService:Create(container, TweenInfo.new(0.2), {BackgroundTransparency = 0.25}):Play() end)
	container.MouseLeave:Connect(function() TweenService:Create(container, TweenInfo.new(0.2), {BackgroundTransparency = 0.4}):Play() end)

	return container, button, checkmark, toggleBox
end

-- =================================================================
-- === UI Construction and Logic ===================================
-- =================================================================

-- DRAGGING FUNCTIONALITY
local isDragging = false
local dragStartPos = Vector2.new(0, 0)
local dragStartFramePosition = UDim2.new(0, 0, 0, 0)
local activeFrame = nil
local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

local function setupDrag(frame: Frame, titleBar: Frame)
	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			isDragging = true
			dragStartPos = input.Position
			dragStartFramePosition = frame.Position
			activeFrame = frame
			UserInputService.MouseIconEnabled = false
		end
	end)
end

UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		isDragging = false
		activeFrame = nil
		UserInputService.MouseIconEnabled = true
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if isDragging and activeFrame and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStartPos
		local newPosition = dragStartFramePosition + UDim2.new(0, delta.X, 0, delta.Y)
		activeFrame.Position = newPosition
	end
end)

-- Create the main UI elements
local mainFrame = createMainFrame(UI_SIZE, UDim2.new(0.5, 0, 0.5, 0), screenGui)
local titleBar, minimizeButton, nukeButton = createTitleBar(mainFrame, "Enhanced Menu")
setupDrag(mainFrame, titleBar)

local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, 0, 1, -MINIMIZED_HEIGHT)
contentFrame.Position = UDim2.new(0, 0, 0, MINIMIZED_HEIGHT)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

local contentListLayout = Instance.new("UIListLayout")
contentListLayout.Padding = UDim.new(0, 0)
contentListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
contentListLayout.SortOrder = Enum.SortOrder.LayoutOrder
contentListLayout.FillDirection = Enum.FillDirection.Horizontal
contentListLayout.Parent = contentFrame

-- Tab container on the left
local tabContainer = Instance.new("Frame")
tabContainer.Name = "TabContainer"
tabContainer.Size = UDim2.new(0, TAB_WIDTH, 1, 0)
tabContainer.BackgroundTransparency = 0.8
tabContainer.BackgroundColor3 = FROSTED_BACKGROUND
tabContainer.Parent = contentFrame

local tabListLayout = Instance.new("UIListLayout")
tabListLayout.Padding = UDim.new(0, 5)
tabListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
tabListLayout.SortOrder = Enum.SortOrder.LayoutOrder
tabListLayout.Parent = tabContainer

local tabPadding = Instance.new("UIPadding")
tabPadding.PaddingTop = UDim.new(0, 10)
tabPadding.PaddingBottom = UDim.new(0, 10)
tabPadding.Parent = tabContainer

-- Tab content container on the right
local tabContentParent = Instance.new("Frame")
tabContentParent.Name = "TabContentParent"
tabContentParent.Size = UDim2.new(1, -TAB_WIDTH, 1, 0)
tabContentParent.Position = UDim2.new(0, TAB_WIDTH, 0, 0)
tabContentParent.BackgroundTransparency = 1
tabContentParent.Parent = contentFrame

local contentPadding = Instance.new("UIPadding")
contentPadding.PaddingTop = UDim.new(0, 10)
contentPadding.PaddingBottom = UDim.new(0, 10)
contentPadding.PaddingLeft = UDim.new(0, 15)
contentPadding.PaddingRight = UDim.new(0, 15)
contentPadding.Parent = tabContentParent

local tabContentListLayout = Instance.new("UIListLayout")
tabContentListLayout.Padding = UDim.new(0, 10)
tabContentListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
tabContentListLayout.SortOrder = Enum.SortOrder.LayoutOrder
tabContentListLayout.Parent = tabContentParent

-- Minimization logic (fixed)
local isMinimized = false
minimizeButton.MouseButton1Click:Connect(function()
	isMinimized = not isMinimized
	local targetSize = if isMinimized then UDim2.new(UI_SIZE.X.Scale, UI_SIZE.X.Offset, 0, MINIMIZED_HEIGHT) else UI_SIZE
	
	if isMinimized then
		contentFrame.Visible = false
		mainFrame.ClipsDescendants = true
	else
		contentFrame.Visible = true
		mainFrame.ClipsDescendants = false
	end

	TweenService:Create(mainFrame, tweenInfo, {Size = targetSize}):Play()
	minimizeButton.Text = if isMinimized then "+" else "-"
end)

-- Tab-specific logic
local contentFrames = {}
local tabButtons = {}
local activeTabName = nil

local function createTabAndContent(name: string, accentColor: Color3, layoutOrder: number)
	local button = createTabButton(tabContainer, name, accentColor, layoutOrder)
	local contentFrame = Instance.new("Frame")
	contentFrame.Name = name .. "Content"
	contentFrame.Size = UDim2.new(1, 0, 1, 0)
	contentFrame.BackgroundTransparency = 1
	contentFrame.Visible = false
	contentFrame.Parent = tabContentParent

	local frameLayout = Instance.new("UIListLayout")
	frameLayout.Padding = UDim.new(0, 10)
	frameLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	frameLayout.SortOrder = Enum.SortOrder.LayoutOrder
	frameLayout.Parent = contentFrame

	button.MouseButton1Click:Connect(function()
		for _, frame in pairs(contentFrames) do frame.Visible = false end
		for _, otherButton in pairs(tabButtons) do
			TweenService:Create(otherButton, tweenInfo, {BackgroundColor3 = FROSTED_BACKGROUND:Lerp(Color3.new(1,1,1), 0.1)}):Play()
		end
		contentFrame.Visible = true
		activeTabName = name
		TweenService:Create(button, tweenInfo, {BackgroundColor3 = accentColor, TextColor3 = FONT_COLOR}):Play()
	end)
	
	contentFrames[name] = contentFrame
	tabButtons[name] = button

	return contentFrame
end


-- Boss Status Tab
local bossContentFrame = createTabAndContent("Boss Status", BOSS_ACCENT, 1)
bossContentFrame.Visible = true
activeTabName = "Boss Status"
TweenService:Create(tabButtons["Boss Status"], tweenInfo, {BackgroundColor3 = BOSS_ACCENT, TextColor3 = FONT_COLOR}):Play()

local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.LayoutOrder = 1
statusLabel.Size = UDim2.new(1, -20, 0, 50)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = FONT_COLOR
statusLabel.TextScaled = true
statusLabel.Font = TITLE_FONT
statusLabel.Text = "Checking for bosses..."
statusLabel.TextXAlignment = Enum.TextXAlignment.Center
statusLabel.Parent = bossContentFrame
	
local enemiesFolder = Workspace:FindFirstChild("Enemies")
if not enemiesFolder then
	statusLabel.Text = "No enemies folder found!"
end
task.spawn(function()
	while task.wait(1) do
		if not screenGui.Parent then break end
		if activeTabName == "Boss Status" and enemiesFolder then
			local sawBoss = enemiesFolder:FindFirstChild("Saw")
			if sawBoss and sawBoss:IsA("Model") then
				-- Code to handle boss status
			else
				statusLabel.Text = "No bosses spawned"
				statusLabel.TextColor3 = FONT_COLOR
			end
		end
	end
end)

-- ESP Tab
local espContentFrame = createTabAndContent("ESP", ESP_ACCENT, 2)
local playerEspLabel = Instance.new("TextLabel")
playerEspLabel.Name = "PlayerEspLabel"
playerEspLabel.LayoutOrder = 1
playerEspLabel.Text = "Player ESP Options"
playerEspLabel.Size = UDim2.new(1, -20, 0, 25)
playerEspLabel.BackgroundTransparency = 1
playerEspLabel.TextColor3 = ESP_ACCENT
playerEspLabel.TextScaled = true
playerEspLabel.Font = TITLE_FONT
playerEspLabel.TextXAlignment = Enum.TextXAlignment.Left
playerEspLabel.Parent = espContentFrame
local playerEspTypes = {
	["Username ESP"] = false,
	["Distance ESP"] = false,
	["Player Tracing"] = false,
}
local playerCheckboxState = {
	["Username ESP"] = false,
	["Distance ESP"] = false,
	["Player Tracing"] = false
}
local playerEspLayoutOrder = 2
local function createPlayerEspCheckbox(espName)
	local container, button, checkmark, toggleBox = createToggleButton(espContentFrame, espName, ACCENT_COLOR, false, playerEspLayoutOrder)
	playerEspLayoutOrder += 1
	button.MouseButton1Click:Connect(function()
		local newState = not playerCheckboxState[espName]
		playerCheckboxState[espName] = newState
		checkmark.Visible = newState
		TweenService:Create(toggleBox, tweenInfo, {BackgroundColor3 = if newState then ACCENT_COLOR else Color3.fromRGB(80, 80, 80)}):Play()
	end)
end
for espName, _ in pairs(playerEspTypes) do
	createPlayerEspCheckbox(espName)
end
local npcEspLabel = Instance.new("TextLabel")
npcEspLabel.Name = "NpcEspLabel"
npcEspLabel.LayoutOrder = playerEspLayoutOrder
npcEspLabel.Text = "NPC ESP Options"
npcEspLabel.Size = UDim2.new(1, -20, 0, 25)
npcEspLabel.BackgroundTransparency = 1
npcEspLabel.TextColor3 = ESP_ACCENT
npcEspLabel.TextScaled = true
npcEspLabel.Font = TITLE_FONT
npcEspLabel.TextXAlignment = Enum.TextXAlignment.Left
npcEspLabel.Parent = espContentFrame
playerEspLayoutOrder += 1
local npcTypes = {
	["Set Home Point"] = false,
	["Boat Dealer"] = false,
}
local npcCheckboxState = {
	["Set Home Point"] = false,
	["Boat Dealer"] = false
}
local function createNpcEspCheckbox(npcName)
	local container, button, checkmark, toggleBox = createToggleButton(espContentFrame, npcName, ESP_ACCENT, false, playerEspLayoutOrder)
	playerEspLayoutOrder += 1
	button.MouseButton1Click:Connect(function()
		local newState = not npcCheckboxState[npcName]
		npcCheckboxState[npcName] = newState
		checkmark.Visible = newState
		TweenService:Create(toggleBox, tweenInfo, {BackgroundColor3 = if newState then ESP_ACCENT else Color3.fromRGB(80, 80, 80)}):Play()
	end)
end
for npcName, _ in pairs(npcTypes) do
	createNpcEspCheckbox(npcName)
end

-- Farm Level Tab
local farmLevelContentFrame = createTabAndContent("Farm Level", FARM_ACCENT, 3)
local farmLevelToggle, farmLevelButton, farmLevelCheckmark, farmLevelToggleBox = createToggleButton(farmLevelContentFrame, "Farm Level", FARM_ACCENT, false, 1)
local isFarmLevelActive = false
local levelStatusFrame = Instance.new("Frame")
levelStatusFrame.Name = "LevelStatusFrame"
levelStatusFrame.LayoutOrder = 2
levelStatusFrame.Size = UDim2.new(1, -20, 0, 50)
levelStatusFrame.BackgroundColor3 = FROSTED_BACKGROUND
levelStatusFrame.BackgroundTransparency = 0.5
levelStatusFrame.BorderSizePixel = 0
levelStatusFrame.ClipsDescendants = true
levelStatusFrame.Visible = false
levelStatusFrame.Parent = farmLevelContentFrame
local levelStatusCorner = Instance.new("UICorner")
levelStatusCorner.CornerRadius = UDim.new(0, 8)
levelStatusCorner.Parent = levelStatusFrame
local levelStatusLabel = Instance.new("TextLabel")
levelStatusLabel.Name = "LevelStatusLabel"
levelStatusLabel.Size = UDim2.new(1, 0, 1, 0)
levelStatusLabel.BackgroundTransparency = 1
levelStatusLabel.TextColor3 = FONT_COLOR
levelStatusLabel.Text = "Level Status"
levelStatusLabel.TextScaled = true
levelStatusLabel.Font = TITLE_FONT
levelStatusLabel.Parent = levelStatusFrame

-- NEW Teleport Tab
local teleportContentFrame = createTabAndContent("Teleport", TELEPORT_ACCENT, 4)

local teleportIslandLabel = Instance.new("TextLabel")
teleportIslandLabel.Name = "TeleportIslandLabel"
teleportIslandLabel.LayoutOrder = 1
teleportIslandLabel.Text = "Select Island"
teleportIslandLabel.Size = UDim2.new(1, -20, 0, 25)
teleportIslandLabel.BackgroundTransparency = 1
teleportIslandLabel.TextColor3 = TELEPORT_ACCENT
teleportIslandLabel.TextScaled = true
teleportIslandLabel.Font = TITLE_FONT
teleportIslandLabel.TextXAlignment = Enum.TextXAlignment.Left
teleportIslandLabel.Parent = teleportContentFrame

local dropdownContainer = Instance.new("Frame")
dropdownContainer.Name = "DropdownContainer"
dropdownContainer.LayoutOrder = 2
dropdownContainer.Size = UDim2.new(1, -20, 0, 45)
dropdownContainer.BackgroundColor3 = FROSTED_BACKGROUND
dropdownContainer.BackgroundTransparency = 0.4
dropdownContainer.BorderSizePixel = 0
dropdownContainer.Parent = teleportContentFrame
local dropdownCorner = Instance.new("UICorner")
dropdownCorner.CornerRadius = UDim.new(0, 8)
dropdownCorner.Parent = dropdownContainer
local dropdownButton = Instance.new("TextButton")
dropdownButton.Name = "DropdownButton"
dropdownButton.Size = UDim2.new(1, 0, 1, 0)
dropdownButton.BackgroundTransparency = 1
dropdownButton.Text = "WindMill"
dropdownButton.TextColor3 = FONT_COLOR
dropdownButton.TextScaled = true
dropdownButton.Font = BODY_FONT
dropdownButton.Parent = dropdownContainer
local dropdownArrow = Instance.new("TextLabel")
dropdownArrow.Size = UDim2.new(0, 20, 1, 0)
dropdownArrow.Position = UDim2.new(1, -30, 0, 0)
dropdownArrow.BackgroundTransparency = 1
dropdownArrow.TextColor3 = FONT_COLOR
dropdownArrow.Text = "â–¼"
dropdownArrow.Font = BODY_FONT
dropdownArrow.Parent = dropdownButton

local dropdownList = Instance.new("Frame")
dropdownList.Name = "DropdownList"
dropdownList.Size = UDim2.new(1, 0, 0, 50)
dropdownList.Position = UDim2.new(0, 0, 1, 5)
dropdownList.BackgroundTransparency = 0.4
dropdownList.BackgroundColor3 = FROSTED_BACKGROUND
dropdownList.BorderSizePixel = 0
dropdownList.Visible = false
dropdownList.Parent = dropdownContainer
local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Parent = dropdownList
local listPadding = Instance.new("UIPadding")
listPadding.PaddingTop = UDim.new(0, 5)
listPadding.PaddingBottom = UDim.new(0, 5)
listPadding.Parent = dropdownList

-- Add list items to the dropdown
local islands = {"WindMill"}
local selectedIsland = "WindMill"
for _, island in pairs(islands) do
	local itemButton = Instance.new("TextButton")
	itemButton.Name = island .. "Item"
	itemButton.Size = UDim2.new(1, -10, 0, 40)
	itemButton.BackgroundColor3 = FROSTED_BACKGROUND:Lerp(Color3.new(1,1,1), 0.1)
	itemButton.BackgroundTransparency = 0.5
	itemButton.BorderSizePixel = 0
	itemButton.Text = island
	itemButton.TextColor3 = FONT_COLOR
	itemButton.Font = BODY_FONT
	itemButton.TextScaled = true
	itemButton.Parent = dropdownList
	local itemCorner = Instance.new("UICorner")
	itemCorner.CornerRadius = UDim.new(0, 5)
	itemCorner.Parent = itemButton
	
	itemButton.MouseButton1Click:Connect(function()
		selectedIsland = island
		dropdownButton.Text = island
		dropdownList.Visible = false
	end)
end

dropdownButton.MouseButton1Click:Connect(function()
	dropdownList.Visible = not dropdownList.Visible
end)

-- Speed slider
local speedContainer = Instance.new("Frame")
speedContainer.Name = "SpeedContainer"
speedContainer.LayoutOrder = 3
speedContainer.Size = UDim2.new(1, -20, 0, 60)
speedContainer.BackgroundColor3 = FROSTED_BACKGROUND
speedContainer.BackgroundTransparency = 0.4
speedContainer.BorderSizePixel = 0
speedContainer.Parent = teleportContentFrame
local speedCorner = Instance.new("UICorner")
speedCorner.CornerRadius = UDim.new(0, 8)
speedCorner.Parent = speedContainer

local speedLabel = Instance.new("TextLabel")
speedLabel.Name = "SpeedLabel"
speedLabel.Size = UDim2.new(1, -20, 0, 20)
speedLabel.Position = UDim2.new(0, 10, 0, 5)
speedLabel.BackgroundTransparency = 1
speedLabel.TextColor3 = FONT_COLOR
speedLabel.Text = "Speed: 100"
speedLabel.TextScaled = true
speedLabel.Font = BODY_FONT
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = speedContainer

local speedSlider = Instance.new("Frame")
speedSlider.Name = "SpeedSlider"
speedSlider.Size = UDim2.new(1, -40, 0, 10)
speedSlider.Position = UDim2.new(0, 20, 0, 30)
speedSlider.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
speedSlider.BorderSizePixel = 0
speedSlider.Parent = speedContainer
local sliderCorner = Instance.new("UICorner")
sliderCorner.CornerRadius = UDim.new(0, 5)
sliderCorner.Parent = speedSlider

local sliderBar = Instance.new("Frame")
sliderBar.Name = "SliderBar"
sliderBar.Size = UDim2.new(0.5, 0, 1, 0)
sliderBar.BackgroundColor3 = ACCENT_COLOR
sliderBar.BorderSizePixel = 0
sliderBar.Parent = speedSlider

local sliderHandle = Instance.new("TextButton")
sliderHandle.Name = "SliderHandle"
sliderHandle.Size = UDim2.new(0, 20, 0, 20)
sliderHandle.Position = UDim2.new(0.5, -10, 0.5, -10)
sliderHandle.BackgroundColor3 = FONT_COLOR
sliderHandle.BorderSizePixel = 0
sliderHandle.Text = ""
sliderHandle.Parent = speedSlider
local handleCorner = Instance.new("UICorner")
handleCorner.CornerRadius = UDim.new(0, 10)
handleCorner.Parent = sliderHandle

local isSliding = false
local speedValue = 100 -- Default speed
local MIN_SPEED = 50
local MAX_SPEED = 300

sliderHandle.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		isSliding = true
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		isSliding = false
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if isSliding and input.UserInputType == Enum.UserInputType.MouseMovement then
		local newX = math.clamp(input.Position.X - speedSlider.AbsolutePosition.X, 0, speedSlider.AbsoluteSize.X)
		local newScale = newX / speedSlider.AbsoluteSize.X
		sliderHandle.Position = UDim2.new(newScale, -10, 0.5, -10)
		sliderBar.Size = UDim2.new(newScale, 0, 1, 0)
		speedValue = math.round(MIN_SPEED + (MAX_SPEED - MIN_SPEED) * newScale)
		speedLabel.Text = "Speed: " .. speedValue
	end
end)

-- Teleport toggle
local teleportToggleContainer, teleportButton, teleportCheckmark, teleportToggleBox = createToggleButton(teleportContentFrame, "Teleport to Selected Island", TELEPORT_ACCENT, false, 4)
local isTeleporting = false

teleportButton.MouseButton1Click:Connect(function()
	local mapFolder = Workspace:FindFirstChild("Map")
	if not mapFolder then
		warn("Map folder not found!")
		return
	end

	local targetModel = mapFolder:FindFirstChild(selectedIsland)
	if not targetModel or not targetModel:IsA("Model") then
		warn("Target model '" .. selectedIsland .. "' not found!")
		return
	end

	local character = player.Character or player.CharacterAdded:Wait()
	local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
	if not humanoidRootPart then
		warn("HumanoidRootPart not found!")
		return
	end

	local tweenDuration = (humanoidRootPart.Position - targetModel:GetPrimaryPartCFrame().Position).Magnitude / speedValue
	local tweenInfo = TweenInfo.new(tweenDuration, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, 0, false, 0)
	local tween = TweenService:Create(humanoidRootPart, tweenInfo, { CFrame = targetModel:GetPrimaryPartCFrame() })

	isTeleporting = not isTeleporting
	teleportCheckmark.Visible = isTeleporting
	TweenService:Create(teleportToggleBox, tweenInfo, {BackgroundColor3 = if isTeleporting then TELEPORT_ACCENT else Color3.fromRGB(80, 80, 80)}):Play()

	if isTeleporting then
		tween:Play()
		tween.Completed:Wait()
		isTeleporting = false
		teleportCheckmark.Visible = false
		TweenService:Create(teleportToggleBox, tweenInfo, {BackgroundColor3 = Color3.fromRGB(80, 80, 80)}):Play()
	else
		tween:Cancel()
	end
end)

-- ESP/Tracer Logic (from original script)
local playerLabels = {}
local playerTracers = {}
local npcLabels = {}
local playerNpcs = {}

local function createPlayerLabel()
	local BillboardGui = Instance.new("BillboardGui")
	BillboardGui.ExtentsOffset = Vector3.new(0, ESP_VERTICAL_OFFSET, 0)
	BillboardGui.Size = UDim2.new(0, 150, 0, 50)
	BillboardGui.Adornment = nil
	BillboardGui.AlwaysOnTop = true

	local TextLabel = Instance.new("TextLabel")
	TextLabel.Size = UDim2.new(1, 0, 1, 0)
	TextLabel.BackgroundTransparency = 0.5
	TextLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	TextLabel.TextColor3 = FONT_COLOR
	TextLabel.TextScaled = true
	TextLabel.Font = BODY_FONT
	TextLabel.Text = "Username"
	TextLabel.Parent = BillboardGui

	local UICorner = Instance.new("UICorner")
	UICorner.CornerRadius = UDim.new(0, 5)
	UICorner.Parent = TextLabel
	
	return BillboardGui
end

local function createPlayerTracer()
	local tracer = Instance.new("Part")
	tracer.Name = "PlayerTracer"
	tracer.Parent = TracerContainer
	tracer.Anchored = true
	tracer.CanCollide = false
	tracer.BrickColor = BrickColor.new(TRACER_COLOR)
	tracer.Transparency = TRACER_TRANSPARENCY
	
	local specialMesh = Instance.new("SpecialMesh")
	specialMesh.MeshType = Enum.MeshType.Cylinder
	specialMesh.Scale = Vector3.new(TRACER_THICKNESS, 1, TRACER_THICKNESS)
	specialMesh.Parent = tracer
	
	return tracer
end

local function updatePlayerLabels()
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and p.Character then
			local rootPart = p.Character:FindFirstChild("HumanoidRootPart")
			if rootPart then
				local label = playerLabels[p]
				if not label then
					label = createPlayerLabel()
					playerLabels[p] = label
				end
				
				local distance = (rootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
				local text = ""
				if playerCheckboxState["Username ESP"] then text = p.Name end
				if playerCheckboxState["Distance ESP"] then text = text .. " (" .. math.floor(distance) .. "m)" end
				
				label.Adornment = rootPart
				label.TextLabel.Text = text
				label.Visible = true
				if text == "" then label.Visible = false end
			end
		end
	end
end

local function updatePlayerTracers()
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and p.Character then
			local rootPart = p.Character:FindFirstChild("HumanoidRootPart")
			if rootPart then
				local tracer = playerTracers[p]
				if not tracer then
					tracer = createPlayerTracer()
					playerTracers[p] = tracer
				end
				
				local startPos = player.Character.HumanoidRootPart.Position
				local endPos = rootPart.Position
				local distance = (startPos - endPos).Magnitude
				
				tracer.Size = Vector3.new(TRACER_THICKNESS, distance, TRACER_THICKNESS)
				tracer.CFrame = CFrame.new(startPos, endPos) * CFrame.new(0, 0, -distance / 2)
				tracer.Transparency = 0.5
			end
		end
	end
end

local function removeAllPlayerLabels()
	for p, label in pairs(playerLabels) do
		label:Destroy()
		playerLabels[p] = nil
	end
	for p, tracer in pairs(playerTracers) do
		tracer:Destroy()
		playerTracers[p] = nil
	end
	
	for _, label in pairs(npcLabels) do
		label:Destroy()
	end
	npcLabels = {}
	
	for _, npc in pairs(playerNpcs) do
		npc:Destroy()
	end
	playerNpcs = {}
end

local function createNpcLabel()
	local BillboardGui = Instance.new("BillboardGui")
	BillboardGui.ExtentsOffset = Vector3.new(0, ESP_VERTICAL_OFFSET, 0)
	BillboardGui.Size = UDim2.new(0, 150, 0, 50)
	BillboardGui.Adornment = nil
	BillboardGui.AlwaysOnTop = true

	local TextLabel = Instance.new("TextLabel")
	TextLabel.Size = UDim2.new(1, 0, 1, 0)
	TextLabel.BackgroundTransparency = 0.5
	TextLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	TextLabel.TextColor3 = FONT_COLOR
	TextLabel.TextScaled = true
	TextLabel.Font = BODY_FONT
	TextLabel.Text = "NPC"
	TextLabel.Parent = BillboardGui

	local UICorner = Instance.new("UICorner")
	UICorner.CornerRadius = UDim.new(0, 5)
	UICorner.Parent = TextLabel
	
	return BillboardGui
end

local function updateNpcLabels()
	for npcName, isActive in pairs(npcCheckboxState) do
		if isActive then
			if playerNpcs[npcName] then
				local npc = playerNpcs[npcName]
				local label = npcLabels[npcName]
				local distance = (player.Character.HumanoidRootPart.Position - npc.HumanoidRootPart.Position).Magnitude
				if distance <= NPC_ESP_DISTANCE then
					label.Adornment = npc.HumanoidRootPart
					label.TextLabel.Text = npcName .. " (" .. math.floor(distance) .. "m)"
					label.Visible = true
				else
					label.Visible = false
				end
			end
		end
	end
end

local function createPlayerLabelsForExistingPlayers()
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and not playerLabels[p] then
			playerLabels[p] = createPlayerLabel()
			playerTracers[p] = createPlayerTracer()
		end
	end
end

-- NPC Logic (from original script)
local function findAndLabelNpcs()
	local npcInstances = {}
	for _, npc in pairs(Workspace:GetDescendants()) do
		if npc:IsA("Model") and npc.Name == "Set Home Point" or npc.Name == "Boat Dealer" then
			local humanoidRootPart = npc:FindFirstChild("HumanoidRootPart")
			if humanoidRootPart then
				npcInstances[npc.Name] = npcInstances[npc.Name] or {}
				table.insert(npcInstances[npc.Name], npc)
			end
		end
	end

	for npcName, instances in pairs(npcInstances) do
		local label = createNpcLabel()
		npcLabels[npcName] = label
		playerNpcs[npcName] = instances[1]
	end
end

findAndLabelNpcs()

Players.PlayerAdded:Connect(function(p)
	if p ~= player then 
		playerLabels[p] = createPlayerLabel() 
		playerTracers[p] = createPlayerTracer() 
	end
end)
Players.PlayerRemoving:Connect(function(p)
	local label = playerLabels[p]
	if label then label:Destroy() playerLabels[p] = nil end
	local tracer = playerTracers[p]
	if tracer then tracer:Destroy() playerTracers[p] = nil end
end)

createPlayerLabelsForExistingPlayers()

RunService.RenderStepped:Connect(function()
	local myRootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
	if not myRootPart then return end
	local isPlayerLabelEspActive = playerCheckboxState["Username ESP"] or playerCheckboxState["Distance ESP"]
	local isTracingActive = playerCheckboxState["Player Tracing"]
	if isPlayerLabelEspActive then updatePlayerLabels() else for _, label in pairs(playerLabels) do label.Visible = false end end
	if isTracingActive then updatePlayerTracers() else for _, tracer in pairs(playerTracers) do tracer.Transparency = 1 end end
	if activeTabName == "ESP" and (npcCheckboxState["Set Home Point"] or npcCheckboxState["Boat Dealer"]) then updateNpcLabels() else for _, label in pairs(npcLabels) do label.Visible = false end end
end)

nukeButton.MouseButton1Click:Connect(function()
	removeAllPlayerLabels()
	mainFrame:Destroy()
end)

